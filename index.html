<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.15" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title> Florent Guilleux &middot; Florent Guilleux </title>

  
  <link rel="stylesheet" href="http://www.florentguilleux.fr/css/poole.css">
  <link rel="stylesheet" href="http://www.florentguilleux.fr/css/syntax.css">
  <link rel="stylesheet" href="http://www.florentguilleux.fr/css/hyde.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="http://www.florentguilleux.fr/index.xml" rel="alternate" type="application/rss+xml" title="Florent Guilleux" />
</head>

<body class="">

<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="http://www.florentguilleux.fr/"><h1>Florent Guilleux</h1></a>
      <p class="lead">
       Software engineer currently working with Ruby and Rails. 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="/">Home</a> </li>
      
        <li><a href="mailto:contact@florentguilleux.fr"> Email </a></li>
      
        <li><a href="https://github.com/Florent2"> GitHub </a></li>
      
        <li><a href="https://speakerdeck.com/florent2"> Speaker Deck </a></li>
      
        <li><a href="http://stackoverflow.com/users/117704/florent2"> stackoverflow </a></li>
      
    </ul>

    <p>&copy; 2016. All rights reserved. </p>
  </div>
</div>


    <div class="content container">
<div class="posts">

  <div class="post">
    <h1 class="post-title">
      <a href="http://www.florentguilleux.fr/posts/elasticsearch/">
        Elasticsearch
      </a>
    </h1>

    <span class="post-date">Sat, Dec 6, 2014</span>

    <p>I presented an introduction about Elasticsearch at the Ruby Peru meetup of December 2014. It explains how it differs from a traditional SQL database, and details how is performed a full text search. Here are the slides: <a href="http://bit.ly/es-rubyperu">http://bit.ly/es-rubyperu</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://www.florentguilleux.fr/posts/rails-anti-patterns/">
        Rails anti patterns
      </a>
    </h1>

    <span class="post-date">Fri, Apr 11, 2014</span>

    <p>I presented a few Rails anti patterns at the <a href="http://ruby.pe/">Ruby Peru</a> meetup of April 2014. Here are the slides:</p>

<script async class="speakerdeck-embed" data-id="4ed4cd10a32801311a754eb53c3a6292" data-ratio="1.33159947984395" src="//speakerdeck.com/assets/embed.js"></script>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://www.florentguilleux.fr/posts/handling-requests-in-parallel-in-rails-applications/">
        Handling Requests in Parallel in Rails Applications
      </a>
    </h1>

    <span class="post-date">Thu, Aug 1, 2013</span>

    <p>I presented an introduction about handling requests in parallel in Rails applications during the <a href="http://ruby.pe/">Ruby Peru</a> meeting of August 2013.</p>

<p>If you want to know more I highly recommend the book <a href="http://www.jstorimer.com/products/working-with-ruby-threads">Working With Ruby Threads</a>, from Jesse Storimer.</p>

<p>Here are the slides:</p>

<script async class="speakerdeck-embed" data-id="80742130dc690130414f7e23ed634b90" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://www.florentguilleux.fr/posts/easier-usage-of-attr_accessible/">
        Easier Usage of attr_accessible
      </a>
    </h1>

    <span class="post-date">Tue, Feb 21, 2012</span>

    <p><a href="http://guides.rubyonrails.org/security.html#mass-assignment"><code>attr_accessible</code> is the recommended method</a> to protect your attributes from mass assignments in Rails. It lists for a model the attributes that can be mass assigned, other attributes will be protected. But it is tedious to build and update this list of accessible attributes while developing an application.</p>

<p>Fortunately there are two mechanisms which facilitate the usage of <code>attr_accessible</code>.</p>

<p>First you can configure your application to create an empty whitelist of attributes available for mass-assignment for all the models. This forces you to explicitly list the accessible attributes of each model, without the risk of forgetting a model or an attribute. To do this just add <code>config.active_record.whitelist_attributes = true</code> in the configuration <code>application.rb</code>.</p>

<p>When a protected attribute is mass assigned, the attribute value is not modified and by default Rails logs a warning. This makes sometimes hard to realize that some attribute isn’t set or modified through a create or update action because it is protected. Since the version 3.2 it is possible to have an exception raised when a protected attribute is mass assigned. Thus it is much easier to detect attributes that should be made accessible. For that just add <code>config.active_record.mass_assignment_sanitizer = :strict</code> to your application configuration, or only in <code>development.rb</code> and <code>test.rb</code> if your prefer.</p>

<p>By combining those two mechanisms it is easy to discover progressively the attributes you want to make accessible while developing your application.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://www.florentguilleux.fr/posts/control-over-standards/">
        Control Over Standards
      </a>
    </h1>

    <span class="post-date">Sun, Oct 2, 2011</span>

    <p><a href="http://www.kenalder.com/measure/index.htm">The Measure of All Things</a> is a great book about the invention the metric system during the French revolution.</p>

<p>The following passage in particular caught my attention:</p>

<blockquote>
<p>Each act of measurement in the Ancien Regime referred to a particular physical standard, held in local hands and safeguarded by local officials. A town’s measure for the length of building materials, for instance, might derive from an iron fathom mortised into the wall of the town’s market hall.
(…)</p>

<p>Not only did the physical standards differ from community to community, but the technique of measurement depended on local custom. One district measured grain heaped high in its bushel; another measured grain after it had been leveled off; still another, after the bushel had been struck to settle its contents.
(…)</p>

<p>This meant that measurements standards were potentially open to dispute, negotiation, and change (…) Outsiders, of course, did no understand these measures, but local buyers and sellers did - which suggests one of the main advantages of local diversity. They kept outsiders out. Distinctive measures protected small-town traders from big-city merchants, or at least forced the latter to pay the equivalent of a fee before the could enter the local market. Artisanal guilds took charge of their own measures so that they might define their goods in a unique way, identify interlopers, and drive them out of business with ruinous lawsuits. This was as true of gunsmiths and milliners then as it is true of the computer industry today. Control over standards is control over the local rules of economic life, and Ancien Régime standards were everywhere local.</p>
</blockquote>

<p>This is still true in the Peruvian Andes where the “quintal” weight measurement may differ from village to village.</p>

<p>I learned that standards wars are not specific to our modern age. Googling a bit more about this, I found <a href="http://faculty.haas.berkeley.edu/shapiro/wars.pdf">this article</a> (PDF) which presents a few other historical examples of standards wars and identifies strategies for companies fighting in such battles.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://www.florentguilleux.fr/posts/an-activerecord-plugin-to-prevent-destroy-if-associations-are-present/">
        An ActiveRecord Plugin to Prevent Destroy if Associations Are Present
      </a>
    </h1>

    <span class="post-date">Sun, Aug 7, 2011</span>

    <p>I’ve just released a <a href="https://github.com/Florent2/prevent_destroy_if_any">small plugin</a> that adds ActiveRecord models a way to prevent destroy if specified <code>has_many</code>, <code>has_one</code> and/or <code>belongs_to</code> associations are present. This is achieved by adding a before_destroy callback that aborts the destroy and adds a base error on the instance when detecting associations.</p>

<p>It’s inspired from <a href="http://stackoverflow.com/questions/4054112/how-do-i-prevent-deletion-of-parent-if-it-has-child-records/4054170#4054170">this stackoverflow answer</a> and was created to factorize this solution when you need it for various models in an application.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://www.florentguilleux.fr/posts/postgresql-geometric-types-in-ruby-and-rails/">
        PostgreSQL Geometric Types in Ruby and Rails
      </a>
    </h1>

    <span class="post-date">Mon, May 30, 2011</span>

    <p>PostgreSQL supports several <a href="http://www.postgresql.org/docs/8.4/static/datatype-geometric.html">geometric types</a> natively (point, line, rectangle, circle…) and <a href="http://www.postgresql.org/docs/8.4/static/functions-geometry.html">operations and operators</a> on these types. Thus PostgreSQL can calculate the distance between 2 points, the diameter of a circle, check if 2 lines intersect or not, if a point is contained in a polygon…</p>

<p>Let see how to leverage these capabilities in Rails with a small demo application that stores the coordinates of different nodes in a 2D plane.</p>

<p>First create the application by choosing PostgreSQL for the database: <code>rails new demo-geo-pg -d postgresql</code></p>

<p>and create the development database: <code>rake db:create</code></p>

<p>Then generate the Node model: <code>rails g model Node name:string coordinates:point</code></p>

<p>The <code>coordinates</code> attribute will store the abscisse and ordinate values of the nodes, it has the PostgreSQL <code>point</code> type. Rails has generated a migration containing the line <code>t.coordinates :point</code> to generate the corresponding column. However if we run the migration as it is, it will fail because point is not a native Rails migration type. We need to change this line into <code>t.column :coordinates, :point</code>. We can now run the migration: <code>rake db:migrate</code></p>

<p>Now use the the Rails console (<code>rails c</code>) to create a few Node records:</p>

<p><code>&gt; Node.create! : Name =&gt; “Node # 1”: coordinates =&gt; “(1.1)”</code>
<code>&gt; Node.create! : Name =&gt; “Node # 2”: coordinates =&gt; “(2.2)”</code>
<code>&gt; Node.create! : Name =&gt; “Node # 3”: coordinates =&gt; “(-2, -2)”</code>
<code>&gt; Node.create! : Name =&gt; “Node # 4”: coordinates =&gt; “(4, -2)”</code></p>

<p>In Ruby we handle PostgreSQL geometric values with strings following a defined syntax: for the <code>point</code> type it is <code>(x,y)</code> (these syntaxes are described in <a href="http://www.postgresql.org/docs/8.4/static/datatype-geometric.html">the PostgreSQL documentation</a>). If this syntax is not respected, PostgreSQL returns an error when trying to save the record in the database:</p>

<p><code>&gt; Node.create! : Name =&gt; “Node # 5”: coordinates =&gt; “1”</code></p>

<p><code>ActiveRecord:: StatementInvalid: PGError: ERROR: invalid input syntax for type point: “1”</code></p>

<p>We could validate the format of the coordinate attribute with:
<code>validates_format_of: coordinates, :with =&gt; /\(-?\d+(?:.\d+)?,-?\d(?:.\d+)?\)/</code></p>

<p>Now let’s use the PostgreSQL geometric operators on our nodes. Here’s how to get all the nodes located in the circle with center (2,2) and radius 2, using the <code>contains @&gt;</code> operator:</p>

<p><code>&gt; Node.where(“circle ‘&lt;(2,2),2&gt;’ @&gt; coordinates”)</code>
<code>=&gt; [#&lt;Node id: 1, name: “Node #1”, coordinates: “(1,1)”, created_at: “2011-05-28 15:00:38”, updated_at: “2011-05-28 15:00:38”&gt;, #&lt;Node id: 2, name: “Node #2”, coordinates: “(1,1)”, created_at: “2011-05-28 15:00:48”, updated_at: “2011-05-28 15:00:48”&gt;]</code></p>

<p>Implementation of an instance method to find the closest node, using the <code>Distance Between &lt;-&gt;</code> operator:</p>

<p><code>def nearest
  where(“id &lt;&gt; #{id}”).select(“*, coordinates &lt;-&gt; point ‘#{coordinates}’ as distance”).order(“distance asc”).limit(1).first
end</code></p>

<p><code>&gt; Node.first.nearest</code>
<code>=&gt; #&lt;Node id: 2, name: “Node #2”, coordinates: “(1,1)”, created_at: “2011-05-28 15:00:48”, updated_at: “2011-05-28 15:00:48”&gt;</code></p>

<p>In some cases the native PostgreSQL geometry types with their functions and operators are adequate and very useful for representing and processing spatial data. When this is not the case, you should use a dedicated tool like <a href="http://www.postgis.org/">PostGIS</a> (there is <a href="http://virtuoso.rubyforge.org/activerecord-postgis-adapter/">an adapter for ActiveRecord</a>). See <a href="http://stackoverflow.com/questions/1023229/spatial-data-in-postgresql">this entry on stackoverflow</a> for more information.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://www.florentguilleux.fr/posts/a-rss-feed-listing-every-day-new-gems-and-updated-gems/">
        A RSS Feed Listing Every Day New Gems and Updated Gems
      </a>
    </h1>

    <span class="post-date">Fri, Apr 15, 2011</span>

    <p>The RubyGems feed and Twitter stream do not distinguish between new gems and updated gems, and announce each new version of a gem.</p>

<p>It was hard for me to follow. That’s why I created <a href="http://gems-summary.heroku.com/">Gems Summary</a>. It generates everyday a feed post listing separately the new gems released on RubyGems and the updated gems. If a gem is updated several times during a single day, it is mentioned only once in the post.</p>

<p>The source code is on <a href="https://github.com/Florent2/gems-summary">GitHub</a>.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://www.florentguilleux.fr/posts/improve-your-rails-development-workflow/">
        Improve Your Rails Development Workflow
      </a>
    </h1>

    <span class="post-date">Mon, Mar 28, 2011</span>

    <p>Here the slides of a presentation I gave for the <a href="http://ruby.pe">Ruby Peru</a> group on March 26, 2011: <a href="https://speakerdeck.com/florent2/improve-your-rails-development-workflow">Improve Your Rails Development Workflow</a>.</p>

<p>It’s about gems and plugins I use to ease the development of my Rails applications, not processes or programming techniques.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://www.florentguilleux.fr/posts/a-single-task-to-migrate-redo-migration-prepare-test-db-and-annotate/">
        A Single Task to Migrate, Redo Migration, Prepare Test Db and Annotate
      </a>
    </h1>

    <span class="post-date">Wed, Feb 9, 2011</span>

    <p>Hi!</p>

<p>My first blog post to announce my first gem: <a href="https://github.com/Florent2/migrate-well">migrate-well</a>. It’s a very simple one, it adds a rake task <code>db:migrate:well</code> that runs the tasks <code>db:migrate</code>, <code>db:migrate:redo</code>, <code>rake db:test:prepare</code> and <code>annotate</code>. I was tired to type all those commands each time…</p>

<p>To install: add <code>gem “migrate-well”</code> in your Gemfile and run <code>bundle install</code>.</p>

<p>To run: <code>rake db:migrate:well</code></p>

<p>Options (updated February 15, 2011):</p>

<ul>
<li><code>redo=false</code>: don’t run the <code>db:migrate:redo</code> task</li>
<li><code>test=false</code>: don’t run the <code>db:test:prepare</code> task</li>
<li><code>anno=false</code>: don’t run the <code>annotate</code> command</li>
</ul>

<p>Examples:</p>

<ul>
<li>run without annotating: <code>rake db:migrate:well anno=false</code></li>
<li>run without annotating and without redoing the migration: <code>rake db:migrate:well anno=false redo=false</code></li>
</ul>

<p>That’s all!</p>

  </div>
  
</div>
</div>

  </body>
</html>
